export class ApiClient {

    constructor(private readonly requestOptions: RequestOptions = defaultRequestOptions()) {
    }


    <% methods.foreach(method => { %>
    async <%= method.endpointName %>(
        <%_ if (!method.wrapParamsInObject) { -%>
        <%_ method.parameters.foreach(p => { -%>
        <%= p.uniqueName %>: <%- p.required && !p.nullable ? p.jsType : `Option<${p.jsType}> = none` %>,
        <%_ }) -%>
        <%_ } else { -%>
        params: {
            <%_ method.parameters.foreach(p => { -%>
            <%= p.uniqueName %><%= p.required && !p.nullable ? '' : '?'%>: <%- p.jsType %>,
            <%_ }) -%>
        },
        <%_ } -%>
        <%_ method.body.foreach(body => { -%>
        body: <%- body.scatsWrapperType %>,
        <%_ }); -%>
        requestOptions: RequestOptions = this.requestOptions
    ): Promise<TryLike<<%- method.response.asProperty.scatsWrapperType %>>> {
        return (await Try.promise(() =>
                <%= method.endpointName %>(
                    <%_ if (!method.wrapParamsInObject) { -%>
                    <%_ method.parameters.foreach(p => { -%>
                    <%= p.uniqueName %><%- p.required && !p.nullable ? '' : `.orUndefined` %>,
                    <%_ }) -%>
                    <%_ } else { -%>
                    params,
                    <%_ } -%>
                    <%_ method.body.foreach(body => { -%>
                    <%_ if (body.schemaType === 'object') { _%>
                    body.toJson,
                    <%_ } else if (body.schemaType === 'property') { _%>
                    <%_ if (body.isArray && body.itemReferencesObject) { _%>
                    body.map(_ => _.toJson).toArray,
                    <%_ } else if (body.isArray && !body.itemReferencesObject) { -%>
                    body.toArray,
                    <%_ } else if (body.referencesObject) { -%>
                    body.toJson,
                    <%_ } else { -%>
                    body,
                    <%_ } -%>
                    <%_ } else { -%>
                    body,
                    <%_ } -%>
                    <%_ }); -%>
                    requestOptions
                )
            ))
            <%_ if (method.response.asProperty.referencesObject) { _%>
            .map(res => <%- method.response.asProperty.scatsWrapperType %>.fromJson(res))
            <%_ } else if (method.response.asProperty.isArray) { _%>
            .map(res => Collection.from(option(res).getOrElseValue([])))
            <%_ if (method.response.asProperty.itemReferencesObject) { _%>
            .map(items => items.map(i => <%- method.response.asProperty.itemScatsWrapperType %>.fromJson(i)))
            <%_ } _%>
            <%_ } _%>;
    }
    <% }); %>


}
