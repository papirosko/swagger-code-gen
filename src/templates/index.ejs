/*********************************************************
 *********************************************************
 *********************************************************
 *********************************************************
 *********************************************************
 *********************************************************
 ************ GENERATED! DO NOT EDIT! ********************
 *********************************************************
 *********************************************************
 *********************************************************
 *********************************************************
 *********************************************************/
import fetch, {Request, Response} from 'node-fetch';
<% if (scats) {%>
import {option, Option, Collection, Try, TryLike, none} from 'scats';
<% } %>

export interface RequestOptions {
    apiPrefix?: string;
    headers?: Record<string, string>;
    preProcessRequest?: (request: Request) => Request;
    postProcessResponse?: (request: Request, response: Response) => Response;
}


export const defaultReqOpts: RequestOptions = {
    apiPrefix: '',
    headers: {
        'Accept': 'application/json',
        'Content-Type': 'application/json'
    }
};

const defaultRequestOptions = () => defaultReqOpts;


async function requestImpl<T>(request: Request, requestOptions: RequestOptions): Promise<T> {
    const preProcessed = requestOptions.preProcessRequest ? requestOptions.preProcessRequest(request) : request;
    const resp = await fetch(preProcessed);
    if (resp.ok) {
        const postProcessed = requestOptions.postProcessResponse ? requestOptions.postProcessResponse(preProcessed, resp) : resp;
        let json: any = null;
        if (postProcessed.headers.has('content-length')) {
            const ct = parseInt(postProcessed.headers.get('content-length'));
            if (ct > 0) {
                json = await postProcessed.json()
            }
        }
        return json as T;
    } else {
        throw resp;
    }

}

<% schemas.foreach(schema => { %>
<%- include('schema.ejs', {schema: schema}); %>
<% }); %>



<% methods.foreach(method => { %>
<%- include('method.ejs', {method: method}); %>
<% }); %>


<% if (scats) {%>
<% schemas.foreach(schema => { %>
<%- include('scats-schema.ejs', {schema: schema}); %>
<% }); %>

<%- include('scats-method.ejs'); %>

<% } %>


